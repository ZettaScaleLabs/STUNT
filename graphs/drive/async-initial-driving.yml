flow: ControlDataDump
configuration:
  host: '192.168.122.35'
  port: 2000
operators:
  - id: Localization
    descriptor:  /home/ato/Workspace/STUNT/nodes/operators/ekf-localization/localization.yml

  - id: TTD
    descriptor:  /home/ato/Workspace/STUNT/nodes/operators/time-to-decision/time-to-decision.yml

  - id: ObjectDetection
    configuration:
      obstacle_detection_model_path: /home/ato/Workspace/models/obstacle_detection/faster-rcnn
      path_coco_labels: /home/ato/Workspace/STUNT/nodes/operators/obstacle-detector/STUNT.names
    descriptor: /home/ato/Workspace/STUNT/nodes/operators/obstacle-detector/obstacle-detector.yml

  - id: TrafficLightDetection
    configuration:
      traffic_light_det_model_path: /home/ato/Workspace/models/traffic_light_detection/faster-rcnn
    descriptor: /home/ato/Workspace/STUNT/nodes/operators/traffic-lights-detector/traffic-lights-detector.yml

  - id: StaticObstacleLocationFinder
    descriptor:  /home/ato/Workspace/STUNT/nodes/operators/obstacle-location-finder/obstacle-location-finder.yml

  - id: SortTracker
    descriptor:  /home/ato/Workspace/STUNT/nodes/operators/sort-tracker/sort-tracker.yml

  - id: ObstacleLocationFinder
    descriptor:  /home/ato/Workspace/STUNT/nodes/operators/obstacle-location-finder/obstacle-location-finder.yml

  - id: ObstacleLocationHistory
    descriptor:  /home/ato/Workspace/STUNT/nodes/operators/obstacle-location-history/obstacle-location-history.yml

  - id: LinearPredictor
    descriptor: /home/ato/Workspace/STUNT/nodes/operators/linear-predictor/linear-predictor.yml

  - id: BehaviourPlanning
    configuration:
      goal: [116.0, 129.0, 0.0]
      map: /home/ato/Workspace/STUNT/var/maps/town01.xodr
    descriptor:  /home/ato/Workspace/STUNT/nodes/operators/behaviour-planning/behaviour-planning.yml

  - id: Planner
    descriptor: /home/ato/Workspace/STUNT/nodes/operators/fot-planner/fot-planner.yml

  - id: PIDController
    configuration:
      # PID parameters
      P: 0.01
      I: 0.5
      D: 0.03
    descriptor: /home/ato/Workspace/STUNT/nodes/operators/pid-control/pid-control.yml


sources:

  - id : Camera
    configuration:
      location: [1.3, 0.0, 1.8]
      frequency: 30
      type: sensor.camera.rgb
      width: 1920
      height: 1080
      fov: 90
      jpeg_quality: 25
    descriptor : /home/ato/Workspace/STUNT/nodes/sources/carla-camera/carla-camera.yml

  - id : Lidar
    configuration:
      location: [1.3,0.0,1.8]
      type: sensor.lidar.ray_cast
      rotation_frequency: 20
      range_cm: 10000
      channels: 16
      upper_fov: 15
      lower_fov: 30
      points-per-second: 500000
      zero_intensity: 0.2
      general_rate: 0.25
      intensity_limit: 0.6
    descriptor : /home/ato/Workspace/STUNT/nodes/sources/carla-lidar/carla-lidar.yml

  - id : TeleCamera
    configuration:
      location: [0.0, 0.0, 2.0]
      frequency: 20
      type: sensor.camera.rgb
      width: 1920
      height: 1080
      fov: 45
      jpeg_quality: 25
    descriptor : /home/ato/Workspace/STUNT/nodes/sources/carla-camera/carla-camera.yml

  - id : TeleLidar
    configuration:
      location: [0.0,0.0,2.0]
      type: sensor.lidar.ray_cast
      rotation_frequency: 20
      range_cm: 8500
      channels: 32
      upper_fov: 15
      lower_fov: 30
      points-per-second: 500000
      zero_intensity: 0.2
      general_rate: 0.25
      intensity_limit: 0.6
    descriptor : /home/ato/Workspace/STUNT/nodes/sources/carla-lidar/carla-lidar.yml

  - id : IMU
    configuration:
      frequency: 1000
    descriptor : /home/ato/Workspace/STUNT/nodes/sources/carla-imu/carla-imu.yml

  - id : GNSS
    configuration:
      frequency: 5
    descriptor : /home/ato/Workspace/STUNT/nodes/sources/carla-gnss/carla-gnss.yml

sinks:
  - id : PyPrint
    descriptor : /home/ato/Workspace/STUNT/nodes/sinks/generic-sink-py/generic-sink.yml

  - id : ZenohCar
    configuration:
      mode: "client"
      key_expression: "stunt/ego-control"
    descriptor : /home/ato/Workspace/STUNT/nodes/sinks/carla-control/carla-control.yml

links:

# sources

#sources to localization
- from:
    node : GNSS
    output : GNSS
  to:
    node : Localization
    input : GNSS


- from:
    node : IMU
    output : IMU
  to:
    node : Localization
    input : IMU

# source from camera and lidar to object detection and tracking

- from:
    node : Camera
    output : Image
  to:
    node : ObjectDetection
    input : Image

- from:
    node : Camera
    output : Image
  to:
    node : SortTracker
    input : Image

- from:
    node : Lidar
    output : LIDAR
  to:
    node : ObstacleLocationFinder
    input : LIDAR

# source from tele camera and tele lidar to traffic lights and static obstacles

- from:
    node : TeleLidar
    output : LIDAR
  to:
    node : StaticObstacleLocationFinder
    input : LIDAR

- from:
    node : TeleCamera
    output : Image
  to:
    node : TrafficLightDetection
    input : Image


# operators


# pose to

- from:
    node : Localization
    output : Pose
  to:
    node : TTD
    input : Pose

- from:
    node : Localization
    output : Pose
  to:
    node : StaticObstacleLocationFinder
    input : Pose

- from:
    node : Localization
    output : Pose
  to:
    node : ObstacleLocationFinder
    input : Pose

- from:
    node : Localization
    output : Pose
  to:
    node : ObstacleLocationHistory
    input : Pose

- from:
    node : Localization
    output : Pose
  to:
    node : BehaviourPlanning
    input : Pose

- from:
    node : Localization
    output : Pose
  to:
    node : Planner
    input : Pose

- from:
    node : Localization
    output : Pose
  to:
    node : PIDController
    input : Pose


# time to decision to

- from:
    node : TTD
    output : TTD
  to:
    node : ObjectDetection
    input : TTD

- from:
    node : TTD
    output : TTD
  to:
    node : SortTracker
    input : TTD

- from:
    node : TTD
    output : TTD
  to:
    node : TrafficLightDetection
    input : TTD

- from:
    node : TTD
    output : TTD
  to:
    node : LinearPredictor
    input : TTD

- from:
    node : TTD
    output : TTD
  to:
    node : Planner
    input : TTD

# obstacles detection and tracking

- from:
    node : ObjectDetection
    output : Obstacles
  to:
    node : SortTracker
    input : Obstacles

- from:
    node : SortTracker
    output : ObstacleTrajectories
  to:
    node : ObstacleLocationFinder
    input : TrackedObstacles

- from:
    node : ObstacleLocationFinder
    output : Obstacles
  to:
    node : ObstacleLocationHistory
    input : Obstacles

- from:
    node : ObstacleLocationHistory
    output : ObstacleTrajectories
  to:
    node : LinearPredictor
    input : ObstacleTrajectories

# traffic lights and static obstacles detection and tracking

- from:
    node : TrafficLightDetection
    output : TrafficLights
  to:
    node : StaticObstacleLocationFinder
    input : TrackedObstacles


# planning

- from:
    node : BehaviourPlanning
    output : Trajectory
  to:
    node : Planner
    input : Trajectory

- from:
    node : LinearPredictor
    output : ObstaclePredictions
  to:
    node : Planner
    input : ObstaclePredictions

- from:
    node : StaticObstacleLocationFinder
    output : Obstacles
  to:
    node : Planner
    input : TrafficLights

- from:
    node : Planner
    output : Waypoints
  to:
    node : PIDController
    input : Waypoints


# sinks
- from:
    node : PIDController
    output : Control
  to:
    node : PyPrint
    input : Data

- from:
    node : PIDController
    output : Control
  to:
    node : ZenohCar
    input : Data