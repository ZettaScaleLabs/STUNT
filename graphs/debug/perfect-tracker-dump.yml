flow: ControlDataDump
vars:
  BASE_DIR: "/var/zenoh-flow"
configuration:
  host: 'carla'
  port: 2000
operators:
  - id: PerfectTracker
    descriptor: "file://{{ BASE_DIR }}/nodes/operators/perfect-tracker/perfect-tracker.yml"

  - id: PerfectLocalization
    descriptor:  "file://{{ BASE_DIR }}/nodes/operators/perfect-localization/localization.yml"

sources:

  - id : CarlaObstacles
    configuration:
      key-expressions:
        Obstacles: "stunt/ground-truth/obstacles"
    descriptor : builtin://zenoh

  # - id : CarlaObstacles
  #   configuration:
  #     locator: "tcp/zenoh-router:7447"
  #     mode: "peer"
  #     key_expression: "stunt/ground-truth/obstacles"
  #     types:
  #       - 'vehicle.*'
  #       - 'walker.pedestrian.*'
  #   descriptor : "file://{{ BASE_DIR }}/nodes/sources/ground-truth/zenoh-obstacles/zenoh-obstacles.yml"

  - id : CarlaLocalization
    configuration:
      key-expressions:
        Pose: "stunt/ground-truth/location"
    descriptor: builtin://zenoh

  # - id : CarlaLocalization
  #   configuration:
  #     locator: "tcp/zenoh-router:7447"
  #     mode: "peer"
  #     key_expression: "stunt/ground-truth/location"
  #   descriptor : "file://{{ BASE_DIR }}/nodes/sources/ground-truth/zenoh-localization/zenoh-location.yml"

sinks:
  - id : PyPrint
    descriptor : "file://{{ BASE_DIR }}/nodes/sinks/generic-sink-py/generic-sink.yml"

links:
#sources
- from:
    node : CarlaLocalization
    output : Pose
  to:
    node : PerfectLocalization
    input : Pose

- from:
    node : CarlaObstacles
    output : Obstacles
  to:
    node : PerfectTracker
    input : Obstacles

# operators
- from:
    node : PerfectLocalization
    output : Pose
  to:
    node : PerfectTracker
    input : Pose

# sinks
- from:
    node : PerfectTracker
    output : ObstacleTrajectories
  to:
    node : PyPrint
    input : Data